{
    "$schema": "http://json-schema.org/draft-07/schema",
    "$id": "https://raw.githubusercontent.com/ScaleBio/nf_methyl/add_result_merging/nextflow_schema.json",
    "title": "ScaleBio Methylation pipeline parameters",
    "description": "See Readme.md for further documentation.",
    "type": "object",
    "definitions": {
        "help_options":{
            "title":"Help options",
            "type":"object",
            "fa_icon": "fas fa-terminal",
            "properties": {
                "help": {
                    "type":"boolean",
                    "description":"Print params description to console?",
                    "hidden":true
                },
                "show_hidden_params":{
                    "type":"boolean",
                    "description":"Show parameters marked as hidden when invoking --help?",
                    "hidden":true
                }
            }
        },
        "input_options": {
            "title": "Input options",
            "type": "object",
            "fa_icon": "fas fa-terminal",
            "description": "Define analysis input data.",
            "properties": {
                "samples": {
                    "type": "string",
                    "format": "file-path",
                    "mimetype": "text/csv",
                    "pattern": "^\\S+\\.csv$",
                    "description": "Csv file describing all samples in the analysis run (required!)",
                    "fa_icon": "fas fa-file-csv"
                },
                "fastqSamplesheet": {
                  "type": "string",
                  "format": "file-path",
                  "mimetype": "text/csv",
                  "pattern": "^\\S+\\.csv$",
                  "description": "Csv file for bcl-convert",
                  "fa_icon": "fas fa-file-csv"
                },
                "runFolder": {
                    "type": "string",
                    "description": "Top-level sequencer run directory (or null when using fastq input)",
                    "format": "directory-path"
                },
                "fastqDir": {
                    "type": "string",
                    "description":"Directory containing pre-generated FASTQs files (or null when using runFolder input)",
                    "format": "directory-path"
                }
            },
            "required": [
                "samples"
            ]
        },
        "output_options": {
            "title": "Output paths and options",
            "type": "object",
            "fa_icon": "fas fa-terminal",
            "properties": {
                "outDir": {
                    "type": "string",
                    "description": "Name of the output directory for workflow results",
                    "format": "directory-path"
                }
            },
            "required": [
                "outDir"
            ]
        },
        "reference_genome_options": {
            "title": "Reference genome options",
            "type": "object",
            "fa_icon": "fas fa-dna",
            "description": "Reference genome related files and options required for the workflow.",
            "properties": {
                "genome": {
                    "type": "string",
                    "description": "json file with paths and parameters for the reference genome (required!)",
                    "format": "file-path",
                    "mimetype": "text/json",
                    "pattern": "^\\S+\\.json$"
                }
            }
        },
        "analysis_options": {
            "title": "Analysis options",
            "type": "object",
            "fa_icon": "fas fa-sliders-h",
            "description": "Configure analysis steps and options",
            "properties": {
                "libStructure": {
                    "type": "string",
                    "format": "file-path",
                    "mimetype": "text/json",
                    "pattern": "^\\S+\\.json$",
                    "description": "Json file describing library structure and index/barcode sequences",
                    "fa_icon": "fas fa-file-json"
                },
                "calculateCH": {
                    "type": "boolean",
                    "description": "Calculate CH context methylation"
                },
                "fastqOut": {
                    "type": "boolean",
                    "description": "Publish fastq files generated by bcl convert and bcParser to output directory"
                },
                "splitFastq": {
                    "type": "boolean",
                    "description": "Enable i5 or i7 splitting for the purpose of bcl conversion"
                },
                "bclConvertParams": {
                    "type": "string",
                    "description": "Extra parameters to be supplied to bcl-convert"
                },
                "covOut": {
                    "type": "boolean",
                    "description": "Publish methylation extraction cov files"
                },
                "allcOut": {
                    "type": "boolean",
                    "description": "Publish ALLC files for analysis with ALLCools"
                },
                "amethystOut": {
                    "type": "boolean",
                    "description": "Publish hdf5 cov files for analysis with Amethyst"
                },
                "windowMatrixOut": {
                    "type": "boolean",
                    "description": "Generate bin methylation matrix from bed file"
                },
                "bamOut": {
                    "type": "boolean",
                    "description": "Publish bam files for all reads"
                },
                "bamDedupOut": {
                    "type": "boolean",
                    "description": "Publish deduplicated bam files"
                },
                "minUniqTotal": {
                    "type": "integer",
                    "description": "Filter for minimum unique/total reads by barcode"
                },
                "maxUniqTotal": {
                    "type": "integer",
                    "description": "Filter for maximum unique/total reads by barcode"
                },
                "minUniqCount": {
                    "type": "integer",
                    "description": "Minimum unique reads for barcode knee plot thresholding"
                }
            }
        },
        "checkpoint_options": {
            "title": "Checkpoint options",
            "type": "object",
            "fa_icon": "fas fa-sliders-h",
            "description": "Provide options for checkpointing and for running only reporting. previousOutDir is required for any option in this list and only one can be set to true at a time.",
            "properties": {
                "previousOutDir": {
                    "type": "string",
                    "description": "Output directory of previous run for reporting or running from a checkpoint. outDir and previousOutDir can be set to the same previous run directory to overwrite previous run outputs.",
                    "format": "directory-path"
                },
                "merged": {
                    "type": "boolean",
                    "description": "Set to true if merging multiple runs, will use resultDir column in samples.csv (see samples.merge.csv in examples for formating) to merge previous runs together (Do not set previousOutDir and merge at the same time)."
                },
                "reportingOnly": {
                    "type": "boolean",
                    "description": "Enable to rerun only reporting(fastqDir or runFolder not required)"
                },
                "startPostAlignment": {
                    "type": "boolean",
                    "description": "Enable to start the workflow from the matrix generation step if the user wishes to include additional outputs to their run or change the binning for downstream cell clustering without needing to re-align. The 'Dedup and Extract>Extract' and 'Metrics and Reporting>GenerateMetrics' processes need to completely finish before this option is available for subsequent runs. (Coverage Parquet files required in output folder)"
                }
            }
        }

    },
    "allOf": [
        {
            "$ref": "#/definitions/help_options"
        },
        {
            "$ref": "#/definitions/input_options"
        },
        {
            "$ref": "#/definitions/output_options"
        },
        {
            "$ref": "#/definitions/reference_genome_options"
        },
        {
            "$ref": "#/definitions/analysis_options"
        },
        {
            "$ref": "#/definitions/checkpoint_options"
        }
    ]
}
